name: hehe

on:
  schedule:
    - cron: '0 */5 * * *' 
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: node:lts-alpine
    steps:
      - name: package
        run: |
          echo "https://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories
          apk update
          apk add --update --no-cache ffmpeg sox imagemagick git neofetch lscpu \
            python3 make g++ jpeg-dev cairo-dev giflib-dev pango-dev libtool autoconf automake openssh
          mkdir ~/.ssh
          ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -C "your_email@example.com"
      - name: git clone
        run: git clone ${{ secrets.sc1 }}
      - name: modul
        run: |
          wget https://github.com/owenthereal/upterm/releases/download/v0.17.0/uptermd_linux_amd64.tar.gz
          tar zxvf *gz
          cd wa1
          npm i -g pm2
          yarn install
          wget -O bantuan/ytdlp "https://github.com/yt-dlp/yt-dlp/releases/download/2025.10.22/yt-dlp"
          chmod +x bantuan/ytdlp
      - name: run
        run: |
          ./uptermd
          cd wa1
          node ghact.js

  rerun-on-failure:
    needs: build
    if: failure() && fromJSON(github.run_attempt) < 3
    runs-on: ubuntu-latest
    steps:
      - env:
          GH_REPO: ${{ github.repository }}
          GH_TOKEN: ${{ secrets.token }}
          GH_DEBUG: api
        run: gh workflow run rerun.yml -F run_id=${{ github.run_id }}
